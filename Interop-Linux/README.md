# AUVSI SUAS 2020 FLU Interop Interface
Following the successful implementation of the 2019 System at the AUVSI SUAS competition, a new revision of the same system has been developed to optimise the uploading of objects, while also making implementation with the computer vision and Linux ground station considerably easier for the 2020 competition. Once complete, ideally, only one script will be required to be run, which will start the interop interface, interop server (if required for testing) and telemetry upload to the server. As of December 2019, these scripts are still in development.  

**NOTE: These files, commands, scripts and functions will only run on a Linux-based operating system, and have been tested on Ubuntu 18.04.**  

## Downloading the Interop System Code
In order to create a local copy of the github repository, run the following lines of code to install git and then clone the repository locally:  

`sudo apt-get install git`  
`git config --global user.email your_email_here`  
`git clone https://github.com/FlightLabsUNSW/FLU-AUVSI-Interop-System.git`  

You should then see the whole file structure in the 'FLU-AUVSI-Interop-System' folder in the home directory, and everything you need for this system is contained in these folders.  

In addition to this, you can run the 'git-functions.sh' script as below, which clones the local repository, using "download" as the input parameter for the script.  

`./FLU-AUVSI-Interop-System/Interop-Linux/bin/git-functions.sh download`  

It is good practice to do this every time before you start working locally if you are editing files, to ensure you have the latest version.  

## Setup & Installation Requirements
For ease of installation and setup on different computers, a startup/setup script has been developed, the 'flu-startup-system.sh' file. To be able to run the startup script, run the following lines of code from the root:  

`cd FLU-AUVSI-Interop-System/Interop-Linux`  
`chmod u+x ./bin/flu-startup-system.sh`  
`./bin/flu-startup-system.sh setup`  

The setup after the file path is extremely important to ensure the script runs the correct functions for setup of the server and running of the FLU Interop Interface.  

## User Input Requirements
To easily collate user-generated information and not require constant re-inputting of data on every upload, the "mission-params.json" file is used. In this file, the following parameters can be configured:  

- ID: Used for debugging only
- IP: Raw IP address of the interop server (i.e. 192.168.1.16)
- Mission ID: Mission ID given to the team (if unsure before comp, use 1)
- Port: Raw port of the interop server (i.e. 8000)
- Username & Password: Login details for the interop server
- Device IP: Full IP address (including port) for telemetry output from MAVProxy (i.e. 192.168.1.16:14550)
- Comport: Serial USB port where telemetry is going into the computer system (i.e. /dev/ttyUSB0)

These parameters must be updated prior to starting the system, and **MUST** be set by the user and are not automatically generated by the FLU interop system.  

## Main Scripts
These scripts contain the main code bodies and function calling, and are named 'flu-main-******.sh' in the Interop-Linux bin folder. There are currently two main scripts.  

1. **flu-main-interop.sh** - Main code body associated with the interaction with the interop server. Includes uploading of objects and images, login process, extraction of mission details, and watching for files to come from the plane to the ground station.  
2. **flu-main-telemetry.sh** - Main code body associated with the upload of telemetry - still currently in progress and subject to further changes after testing of the telemetry system in 2020.  

## Function Scripts
These scripts contain the main functions associated with the main scripts, and are named 'flu-functions-******.sh' in the Interop-Linux bin folder. There are currently two function scripts, along with a git-functions script for source control.  

1. **flu-functions-interop.sh** - Functions that are used in the flu-main-interop.sh script, primarily used to clean up the main scripts and make debugging easier.  
2. **flu-functions-server.sh** - Functions that are used in the setup of the system, along with starting and upgrading the interop server, as well as starting the telemetry stream to the interop server.  

## File Structure
The file structure is extremely important, as majority of the locations are hard-coded into the system. Please **DO NOT** change the file structure of the Github unless it has been discussed and changed in the code. All of the main code is in the 'bin' folder, and all of the scripts reside in this folder.  

Within the 'bin' folder, there are three main folders, 'archive', 'plane-data', and 'Test-Data', with their functions described below:  

1. **archive** - All files, after being uploaded to the interop server, end up in this folder for easy checking of uploading and verifying correct objects. This folder should be clear of zip, json, jpg, and png files before starting.
2. **plane-data** - Folder where the zip folders from the plane will arrive in, and is being watched by the system for the arrival of zip folders.
3. **Test-Data** - Folder for the storage of dummy objects in zip folders, containing a json and jpg file. If you are editing the JSON files in the Test-Data zip folders, be sure to follow the API at the following link: https://github.com/auvsi-suas/interop/blob/master/proto/interop_api.proto  

## Debugging
Most debugging can be done in the command line interface, with reasonable error codes and locations presented in the case of failures in the system. A common error that has been run into so far:  

1. **Denied permissions for running scripts** - run the following line of code to allow the running of a particular script:  
`chmod u+x /path-to-source/filename.extension`  

This section will be expanded upon when other running errors are identified and mitigated, either in code or through a short input as above.  

## Source Control
If you are editing local files, instead of having to copy/paste or reupload files individually, git can be used to add, commit and push files directly to the master branch from local.  

`cd FLU-AUVSI-Interop-System`  
`git add Interop-Linux`  
`git commit`  

A screen will appear, prompting you to add a commit message, please make it concise and descriptive. When you are done, press Ctrl+X, type 'y', then press Enter to confirm the commit. To finish, run:  

`git push`  

Instead of running these four lines individually, the 'git-functions.sh' script can be run again using "upload" as the input parameter.  

`./FLU-AUVSI-Interop-System/Interop-Linux/bin/git-functions.sh upload`  

You will be required to log in to push commits to the master branch, so be sure to have access to the FLU github and know your username and password.  

## Full System Testing
Description

### Setup and Starting Interop Server (Judging)
Description

### Accessing the Interop Server (Judging)
Description

### Adding, Editing and Viewing Mission Details (as a Judge)
Description

### Reviewing ODLCs
Description

### Viewing Live KMZ/KML Data (to be tested)
Description

### Mission Evaluation (Automated, to be tested)
Description
